<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M∆∞a l·ªùi khen 14/02</title>
    <style>
      :root {
        --bg: #000;
        --pink: #ff4da6;
        --pink2: #ff77c8;
        --white: #fff;
        --glass: rgba(255, 255, 255, 0.08);
        --border: rgba(255, 255, 255, 0.16);
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial,
          sans-serif;
      }
      body {
        background: var(--bg);
        overflow: hidden;
        color: var(--white);
      }

      /* Center stage */
      .stage {
        position: fixed;
        inset: 0;
        display: grid;
        place-items: center;
        background:
          radial-gradient(
            1000px 600px at 50% 40%,
            rgba(255, 77, 166, 0.12),
            transparent 60%
          ),
          radial-gradient(
            900px 500px at 50% 70%,
            rgba(255, 119, 200, 0.08),
            transparent 60%
          ),
          #000;
        transition: opacity 900ms ease;
        opacity: 1;
        z-index: 10;
      }
      .stage.fade-out {
        opacity: 0;
        pointer-events: none;
      }

      /* Heart button */
      .heart-btn {
        width: min(220px, 55vw);
        aspect-ratio: 1 / 1;
        border: none;
        background: transparent;
        cursor: pointer;
        position: relative;
        display: grid;
        place-items: center;
        transform: translateZ(0);
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      .heart {
        width: 46%;
        height: 46%;
        filter: drop-shadow(0 0 14px rgba(255, 77, 166, 0.65));
        animation: pulse 1.25s ease-in-out infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.08);
        }
      }
      .hint {
        position: absolute;
        top: calc(50% + 120px);
        width: 100%;
        text-align: center;
        font-size: 14px;
        color: #fff;
        opacity: 0.8;
        letter-spacing: 0.2px;
      }

      /* Rain layer */
      .rain {
        position: fixed;
        inset: 0;
        pointer-events: none;
        opacity: 0;
        transition: opacity 900ms ease;
        z-index: 4;
      }
      .rain.show {
        opacity: 1;
      }

      /* Floating compliment */
      /* Floating compliment (Glow m·∫°nh - tƒ©nh - m∆∞·ª£t) */
      .drop {
        position: absolute;
        top: -10vh;
        left: 0;
        white-space: nowrap;
        font-weight: 900;
        letter-spacing: 0.25px;

        will-change: transform, opacity;
        transform: translate3d(var(--x), -20vh, 0) rotate(var(--rot));
        animation: fall var(--dur) linear forwards;

        opacity: 0.98;
        font-size: var(--fs);
        color: var(--clr);

        /* Glow m·∫°nh h∆°n b·∫±ng text-shadow (nh√¨n r√µ) */
        text-shadow:
          0 2px 10px rgba(0, 0, 0, 0.7),
          0 0 10px rgba(255, 255, 255, 0.25),
          0 0 20px rgba(255, 255, 255, 0.15);

        /* 1 l·ªõp drop-shadow nh∆∞ng alpha cao h∆°n */
        filter: drop-shadow(0 0 18px rgba(255, 255, 255, 0.12));
      }

      /* H√†o quang m·∫°nh: d√πng ::before ‚ÄúƒÉn theo m√†u ch·ªØ‚Äù */
      .drop::before {
        content: "";
        position: absolute;
        left: 50%;
        top: 50%;
        width: 220%;
        height: 240%;
        transform: translate(-50%, -55%);
        border-radius: 999px;

        /* halo theo m√†u ch·ªØ */
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.24) 0%,
          color-mix(in srgb, var(--clr) 55%, transparent) 35%,
          transparent 70%
        );

        filter: blur(20px);
        opacity: 0.9;
        pointer-events: none;
      }

      /* ƒë·ªÉ text n·∫±m tr√™n glow */
      .drop > * {
        position: relative;
        z-index: 1;
      }

      .drop .emoji {
        margin-left: 0.35em;
        opacity: 0.95;
      }

      @keyframes fall {
        0% {
          transform: translate3d(var(--x), -18vh, 0) rotate(var(--rot));
          opacity: 0;
        }
        6% {
          opacity: 0.95;
        }
        100% {
          transform: translate3d(var(--x), 112vh, 0)
            rotate(calc(var(--rot) * -1));
          opacity: 0.05;
        }
      }

      /* subtle stars */
      canvas#stars {
        position: fixed;
        inset: 0;
        opacity: 0.85; /* s√°ng h∆°n */
        mix-blend-mode: screen;
        z-index: 3; /* n·∫±m d∆∞·ªõi rain (4) v√† stage (10) */
        pointer-events: none;
      }

      /* CTA appears after 5s of rain */
      .cta-wrap {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 20px;
        display: grid;
        place-items: center;
        pointer-events: none;
        z-index: 20;
      }
      .cta {
        pointer-events: auto;
        opacity: 0;
        transform: translateY(14px);
        transition:
          opacity 600ms ease,
          transform 600ms ease;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: linear-gradient(
          135deg,
          rgba(255, 77, 166, 0.9),
          rgba(255, 119, 200, 0.75)
        );
        color: #fff;
        padding: 12px 16px;
        border-radius: 999px;
        font-weight: 900;
        letter-spacing: 0.2px;
        cursor: pointer;
        box-shadow: 0 10px 34px rgba(255, 77, 166, 0.22);
        -webkit-tap-highlight-color: transparent;
      }
      .cta.show {
        opacity: 1;
        transform: translateY(0);
      }

      /* ===== Lixi pick screen ===== */
      .lixi-screen {
        position: fixed;
        inset: 0;
        display: grid;
        place-items: center;
        z-index: 25;
        opacity: 0;
        pointer-events: none;
        transition: opacity 500ms ease;
        background:
          radial-gradient(
            900px 520px at 50% 35%,
            rgba(255, 42, 109, 0.16),
            transparent 62%
          ),
          radial-gradient(
            900px 520px at 50% 75%,
            rgba(195, 0, 63, 0.13),
            transparent 62%
          ),
          rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
      }
      .lixi-screen.show {
        opacity: 1;
        pointer-events: auto;
      }

      .panel {
        width: min(820px, 92vw);
        border: 1px solid var(--border);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.06)
        );
        border-radius: 22px;
        padding: 18px 16px 16px;
        box-shadow: 0 24px 70px rgba(0, 0, 0, 0.45);
      }
      .panel h2 {
        margin: 0;
        font-size: 20px;
        letter-spacing: 0.2px;
      }
      .panel p {
        margin: 8px 0 14px;
        opacity: 0.9;
        line-height: 1.35;
        font-size: 14px;
      }

      .lixi-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
        margin-top: 10px;
      }
      @media (max-width: 640px) {
        .lixi-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      }
      .lixi-btn {
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: rgba(255, 255, 255, 0.06);
        border-radius: 16px;
        padding: 10px;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
        transition:
          transform 220ms ease,
          opacity 220ms ease,
          filter 220ms ease;
      }
      .lixi-btn:hover {
        transform: translateY(-2px);
      }
      .lixi-btn:active {
        transform: translateY(0) scale(0.99);
      }
      .lixi-img {
        width: 100%;
        aspect-ratio: 1 / 2; /* t·ª´ 3/4 -> 1/2 */
        object-fit: cover;
        border-radius: 12px;
        display: block;
        filter: drop-shadow(0 10px 24px rgba(0, 0, 0, 0.35));
      }
      .lixi-btn.dim {
        opacity: 0.35;
        filter: grayscale(0.2);
      }

      /* ===== Countdown overlay (full black) ===== */
      .countdown-overlay {
        position: fixed;
        inset: 0;
        z-index: 40;
        background: #000;
        display: grid;
        place-items: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 180ms ease;
      }
      .countdown-overlay.show {
        opacity: 1;
        pointer-events: auto;
      }
      .countdown-text {
        text-align: center;
        font-weight: 1000;
        letter-spacing: 0.6px;
        line-height: 1.05;
        text-shadow: 0 0 22px rgba(255, 77, 166, 0.25);
        padding: 0 14px;
      }
      .countdown-text .line1 {
        font-size: clamp(22px, 5vw, 40px);
        opacity: 0.92;
      }
      .countdown-text .num {
        margin-top: 10px;
        font-size: clamp(64px, 16vw, 140px);
        color: #fff;
      }
      .countdown-text .boom {
        margin-top: 10px;
        font-size: clamp(34px, 10vw, 84px);
        background: linear-gradient(135deg, #ff4da6, #ff77c8);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      /* ===== Wish screen ===== */
      .wish-screen {
        position: fixed;
        inset: 0;
        z-index: 45;
        display: grid;
        place-items: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 420ms ease;
        background:
          radial-gradient(
            1000px 620px at 50% 40%,
            rgba(255, 77, 166, 0.14),
            transparent 62%
          ),
          radial-gradient(
            900px 520px at 50% 75%,
            rgba(255, 119, 200, 0.1),
            transparent 62%
          ),
          rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
      }
      .wish-screen.show {
        opacity: 1;
        pointer-events: auto;
      }

      .wish-card {
        width: min(760px, 92vw);
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.12),
          rgba(255, 255, 255, 0.06)
        );
        border-radius: 22px;
        padding: 18px 16px 16px;
        box-shadow: 0 24px 70px rgba(0, 0, 0, 0.45);
      }
      .wish-title {
        font-weight: 950;
        font-size: 18px;
        margin: 0 0 10px;
      }
      .wish-box {
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(0, 0, 0, 0.18);
        border-radius: 18px;
        padding: 14px 14px 12px;
      }
      .money {
        font-size: 28px;
        font-weight: 1000;
        letter-spacing: 0.4px;
      }
      .wish-text {
        margin-top: 8px;
        font-size: 16px;
        font-weight: 750;
        line-height: 1.45;
        opacity: 0.94;
      }
      .note {
        margin-top: 8px;
        opacity: 0.86;
        font-size: 13px;
        line-height: 1.45;
      }
      .only-btn {
        margin-top: 14px;
        width: 100%;
        border: 1px solid rgba(255, 255, 255, 0.16);
        background: linear-gradient(
          135deg,
          rgba(255, 77, 166, 0.88),
          rgba(255, 119, 200, 0.75)
        );
        color: #fff;
        padding: 12px 14px;
        border-radius: 999px;
        font-weight: 1000;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
        box-shadow: 0 14px 40px rgba(255, 77, 166, 0.18);
      }

      /* ===== Final screen ===== */
      .final-screen {
        position: fixed;
        inset: 0;
        z-index: 50;
        display: grid;
        place-items: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 520ms ease;
        background:
          radial-gradient(
            1000px 620px at 50% 40%,
            rgba(255, 77, 166, 0.18),
            transparent 62%
          ),
          radial-gradient(
            900px 520px at 50% 75%,
            rgba(255, 119, 200, 0.12),
            transparent 62%
          ),
          #000;
      }
      .final-screen.show {
        opacity: 1;
        pointer-events: auto;
      }

      .final-wrap {
        text-align: center;
        padding: 0 16px;
      }
      .final-text {
        font-weight: 1100;
        font-size: clamp(26px, 7vw, 54px);
        letter-spacing: 0.3px;
        margin-bottom: 18px;
        text-shadow: 0 0 22px rgba(255, 77, 166, 0.22);
      }
      .big-heart {
        width: min(340px, 70vw);
        aspect-ratio: 1/1;
        filter: drop-shadow(0 0 26px rgba(255, 77, 166, 0.45));
      }
      .photo-heart {
        width: min(360px, 78vw);
        aspect-ratio: 1/1;
        filter: drop-shadow(0 0 22px rgba(255, 77, 166, 0.35))
          drop-shadow(0 0 55px rgba(255, 119, 200, 0.22));
      }

      /* reduce motion */
      @media (prefers-reduced-motion: reduce) {
        .heart {
          animation: none;
        }
        .drop {
          animation-duration: 6s !important;
        }
      }
      /* ===== Final text animation ===== */
      .final-text {
        animation:
          titlePop 900ms cubic-bezier(0.2, 0.9, 0.2, 1) both,
          titleGlow 1600ms ease-in-out 0.2s infinite alternate;
      }

      @keyframes titlePop {
        0% {
          opacity: 0;
          transform: translateY(10px) scale(0.96);
          filter: blur(2px);
        }
        70% {
          opacity: 1;
          transform: translateY(0) scale(1.02);
          filter: blur(0);
        }
        100% {
          transform: translateY(0) scale(1);
        }
      }

      @keyframes titleGlow {
        from {
          text-shadow:
            0 0 10px rgba(255, 77, 166, 0.18),
            0 0 22px rgba(255, 119, 200, 0.12);
        }
        to {
          text-shadow:
            0 0 14px rgba(255, 77, 166, 0.32),
            0 0 34px rgba(255, 119, 200, 0.22);
        }
      }

      /* ===== Heart rain background (behind content) ===== */
      .heart-rain {
        position: fixed;
        inset: 0;
        z-index: 2; /* d∆∞·ªõi stars(3) hay tr√™n? b·∫°n mu·ªën sau n·ªÅn -> ƒë·ªÉ 2 */
        pointer-events: none;
        opacity: 0;
        transition: opacity 600ms ease;
      }
      .heart-rain.show {
        opacity: 1;
      }

      .heart-drop {
        position: absolute;
        top: -12vh;
        left: 0;
        will-change: transform, opacity;
        transform: translate3d(var(--x), -20vh, 0) rotate(var(--rot));
        animation: heartFall var(--dur) linear forwards;
        opacity: 0.95;
        filter: drop-shadow(0 0 14px rgba(255, 77, 166, 0.45));
      }

      .heart-drop svg {
        width: var(--sz);
        height: var(--sz);
        display: block;
      }

      @keyframes heartFall {
        0% {
          transform: translate3d(var(--x), -18vh, 0) rotate(var(--rot));
          opacity: 0;
        }
        8% {
          opacity: 0.95;
        }
        100% {
          transform: translate3d(var(--x), 112vh, 0)
            rotate(calc(var(--rot) * -1));
          opacity: 0.05;
        }
      }

      /* n·∫øu b·∫°n mu·ªën heart-rain n·∫±m TR√äN stars th√¨ ƒë·ªïi z-index = 3.5 (kh√¥ng c√≥), 
   n√™n: set canvas#stars z-index:1; v√† heart-rain z-index:2 */
    </style>
  </head>
  <body>
    <canvas id="stars"></canvas>

    <div class="heart-rain" id="heartRain"></div>

    <div class="stage" id="stage">
      <button class="heart-btn" id="heartBtn" aria-label="B·∫•m ƒë·ªÉ b·∫Øt ƒë·∫ßu">
        <svg class="heart" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path
            d="M12 21s-7.2-4.4-9.6-8.7C.6 9.3 2.2 5.8 5.7 5.1c1.8-.4 3.6.3 4.7 1.6 1.1-1.3 2.9-2 4.7-1.6 3.5.7 5.1 4.2 3.3 7.2C19.2 16.6 12 21 12 21z"
            fill="url(#g)"
          />
          <defs>
            <linearGradient
              id="g"
              x1="3"
              y1="4"
              x2="20"
              y2="22"
              gradientUnits="userSpaceOnUse"
            >
              <stop stop-color="#ff4da6" />
              <stop offset="1" stop-color="#ff77c8" />
            </linearGradient>
          </defs>
        </svg>
        <div class="hint">Ch·∫°m v√†o tr√°i tim üíñ</div>
      </button>
    </div>

    <div class="rain" id="rain"></div>

    <div class="cta-wrap">
      <button class="cta" id="toLixiBtn">B·ªëc l√¨ x√¨ ƒë·∫ßu nƒÉm kh√¥ng? üßß</button>
    </div>

    <!-- Pick screen -->
    <div class="lixi-screen" id="lixiScreen" aria-hidden="true">
      <div class="panel">
        <h2>üßß Ch·ªçn 1 bao l√¨ x√¨</h2>
        <p>Ch·∫°m v√†o m·ªôt bao b·∫•t k·ª≥ nha‚Ä¶ r·ªìi nh·∫Øm m·∫Øt ch·ªù ‚Äúb√πm‚Äù üíó</p>
        <div class="lixi-grid" id="lixiGrid"></div>
      </div>
    </div>

    <!-- Countdown overlay -->
    <div class="countdown-overlay" id="countOverlay" aria-hidden="true">
      <div class="countdown-text">
        <div class="line1" id="cdLine">Chu·∫©n b·ªã m·ªü‚Ä¶</div>
        <div class="num" id="cdNum">3</div>
        <div class="boom" id="cdBoom" style="display: none">B√ôM! ‚ú®</div>
      </div>
    </div>

    <!-- Wish screen -->
    <div class="wish-screen" id="wishScreen" aria-hidden="true">
      <div class="wish-card">
        <div class="wish-title">üéâ L√¨ x√¨ c·ªßa em</div>
        <div class="wish-box">
          <div class="money" id="moneyText"></div>
          <div class="wish-text" id="wishText"></div>
          <div class="note" id="noteText"></div>
        </div>
        <button class="only-btn" id="continueBtn">Ti·∫øp t·ª•c üíñ</button>
      </div>
    </div>

    <!-- Final screen -->
    <!-- Final screen -->
    <div class="final-screen" id="finalScreen" aria-hidden="true">
      <div class="final-wrap">
        <div class="final-text">C·∫£m ∆°n em ‚Äî Y√™u em ‚ù§Ô∏è</div>

        <!-- HEART PHOTO (SVG MASK - works everywhere) -->
        <svg
          class="photo-heart"
          viewBox="0 0 24 24"
          aria-label="·∫¢nh trong khung tr√°i tim"
        >
          <defs>
            <clipPath id="heartClip">
              <path
                d="M12 21s-7.2-4.4-9.6-8.7C.6 9.3 2.2 5.8 5.7 5.1c1.8-.4 3.6.3 4.7 1.6 1.1-1.3 2.9-2 4.7-1.6 3.5.7 5.1 4.2 3.3 7.2C19.2 16.6 12 21 12 21z"
              />
            </clipPath>

            <!-- glow -->
            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="0.6" result="blur" />
              <feMerge>
                <feMergeNode in="blur" />
                <feMergeNode in="SourceGraphic" />
              </feMerge>
            </filter>
          </defs>

          <!-- ·∫£nh -->
          <image
            href="anhdoi.jpg"
            x="0"
            y="0"
            width="24"
            height="24"
            preserveAspectRatio="xMidYMid slice"
            clip-path="url(#heartClip)"
          ></image>

          <!-- vi·ªÅn -->
          <path
            d="M12 21s-7.2-4.4-9.6-8.7C.6 9.3 2.2 5.8 5.7 5.1c1.8-.4 3.6.3 4.7 1.6 1.1-1.3 2.9-2 4.7-1.6 3.5.7 5.1 4.2 3.3 7.2C19.2 16.6 12 21 12 21z"
            fill="none"
            stroke="rgba(255,255,255,0.35)"
            stroke-width="0.7"
            filter="url(#glow)"
          />
        </svg>
      </div>
    </div>

    <script>
      // ====== CONFIG ======
      const COMPLIMENTS = [
        "Em l√† ƒëi·ªÅu tuy·ªát v·ªùi nh·∫•t",
        "Em xinh qu√° tr·ªùi lu√¥n",
        "·ªû b√™n em l√† h·∫°nh ph√∫c",
        "C∆∞·ªùi l√™n nh√¨n d·ªÖ th∆∞∆°ng l·∫Øm",
        "Em l√†m anh nh·ªõ qu√°",
        "Em l√† c·∫£ b·∫ßu tr·ªùi c·ªßa anh",
        "Anh th∆∞∆°ng em nhi·ªÅu l·∫Øm",
        "Em ƒë√°ng y√™u c·ª±c k·ª≥",
        "Em l√† ng∆∞·ªùi ƒë·∫∑c bi·ªát nh·∫•t",
        "Ch√∫c em lu√¥n vui v·∫ª",
        "Ch√∫c em lu√¥n h·∫°nh ph√∫c",
        "M√£i b√™n anh nh√©",
        "Y√™u em nhi·ªÅu h∆°n h√¥m qua",
        "Em r·ª±c r·ª° nh∆∞ √°nh sao",
        "Em l√† s·ªë 1 trong l√≤ng anh",
        "C·∫£m ∆°n em v√¨ ƒë√£ ƒë·∫øn",
        "Em l√† ph√©p m√†u c·ªßa anh",
        "H√¥m nay em ƒë·∫πp qu√°",
        "Em l√†m m·ªçi th·ª© tr·ªü n√™n t·ªët h∆°n",
        "Anh y√™u em",
      ];
      const EMOJIS = [
        "üíñ",
        "‚ú®",
        "üíó",
        "üíï",
        "üå∏",
        "ü•∞",
        "üíû",
        "üíò",
        "üåü",
        "‚ù§Ô∏è",
      ];
      const COLORS = [
        "#ff4da6",
        "#ff77c8",
        "#ffffff",
        "#ffd1ea",
        "#ffb3dc",
        "#ffe0f1",
        "#ff2a6d",
        "#ff5fd7",
        "#c77dff",
        "#7c4dff",
        "#4dd7ff",
        "#3bf0c7",
        "#7dff6a",
        "#ffe66d",
        "#ff9f1c",
        "#ff4d4d",
      ];

      const START_RATE_MS = 140;
      const BURST_COUNT = 18;
      const MAX_DROPS = 160;

      // ====== LIXI CONFIG ======
      const LIXI_IMAGES = [
        "lixi1.png",
        "lixi2.png",
        "lixi3.png",
        "lixi4.png",
        "lixi5.png",
      ];
      const MONEY_LIST = [
        "68.688ƒë",
        "88.888ƒë",
        "131.452ƒë",
        "199.999ƒë",
        "520.000ƒë",
      ];
      const NEWYEAR_WISHES = [
        "Ch√∫c em m·ªôt nƒÉm m·ªõi b√¨nh an, r·ª±c r·ª° v√† lu√¥n hay c∆∞·ªùi üå∏",
        "Ch√∫c em lu√¥n ƒë∆∞·ª£c y√™u th∆∞∆°ng th·∫≠t nhi·ªÅu, theo c√°ch em x·ª©ng ƒë√°ng üíó",
        "Ch√∫c em m·ªçi ƒëi·ªÅu t·ªët l√†nh s·∫Ω t√¨m ƒë·∫øn, c√≤n anh th√¨ lu√¥n t√¨m ƒë·∫øn em ü•∞",
        "Ch√∫c em nƒÉm m·ªõi g·∫∑p to√†n chuy·ªán vui, v√† anh ƒë∆∞·ª£c ·ªü c·∫°nh chia s·∫ª h·∫øt üíû",
        "Ch√∫c em m·∫°nh kh·ªèe, h·∫°nh ph√∫c, v√† m·ªói ng√†y ƒë·ªÅu th·∫•y m√¨nh ƒë√°ng y√™u ‚ú®",
      ];
      const FIXED_NOTE =
        "Bao l√¨ x√¨ n√†y nh·ªè th√¥i‚Ä¶ nh∆∞ng anh nghi√™m t√∫c v·ªÅ chuy·ªán th∆∞∆°ng em ‚ù§Ô∏è";

      // ====== STATE / DOM ======
      const stage = document.getElementById("stage");
      const rain = document.getElementById("rain");
      const heartBtn = document.getElementById("heartBtn");

      const toLixiBtn = document.getElementById("toLixiBtn");

      const lixiScreen = document.getElementById("lixiScreen");
      const lixiGrid = document.getElementById("lixiGrid");

      const countOverlay = document.getElementById("countOverlay");
      const cdLine = document.getElementById("cdLine");
      const cdNum = document.getElementById("cdNum");
      const cdBoom = document.getElementById("cdBoom");

      const wishScreen = document.getElementById("wishScreen");
      const moneyText = document.getElementById("moneyText");
      const wishText = document.getElementById("wishText");
      const noteText = document.getElementById("noteText");
      const continueBtn = document.getElementById("continueBtn");

      const finalScreen = document.getElementById("finalScreen");

      let started = false;
      let timer = null;
      let ctaTimeout = null;
      let locked = false; // prevent multi clicks
      let picked = false;

      function rand(min, max) {
        return Math.random() * (max - min) + min;
      }
      function pick(arr) {
        return arr[Math.floor(Math.random() * arr.length)];
      }

      // ====== RAIN ======
      function createDrop() {
        if (rain.childElementCount > MAX_DROPS) {
          for (let i = 0; i < 10 && rain.firstChild; i++)
            rain.removeChild(rain.firstChild);
        }
        const el = document.createElement("div");
        el.className = "drop";

        const text = pick(COMPLIMENTS);
        const emoji = pick(EMOJIS);
        el.innerHTML = `<span>${text}</span><span class="emoji">${emoji}</span>`;

        const x = rand(0, window.innerWidth); // px
        const dur = rand(5.2, 9.5);
        const isPhone = window.matchMedia("(max-width: 520px)").matches;
        const fs = isPhone ? rand(10, 18) : rand(14, 28);
        const rot = rand(-10, 10);
        const clr = pick(COLORS);

        el.style.setProperty("--x", x + "vw");
        el.style.setProperty("--dur", dur + "s");
        el.style.setProperty("--fs", fs + "px");
        el.style.setProperty("--rot", rot + "deg");
        el.style.setProperty("--clr", clr);

        rain.appendChild(el);
        const w = el.offsetWidth;
        el.style.setProperty("--x", x - w / 2 + "px");
        el.addEventListener("animationend", () => el.remove());
      }

      function burst(n = 12) {
        for (let i = 0; i < n; i++) {
          setTimeout(createDrop, i * 35);
        }
      }

      function startRain() {
        rain.classList.add("show");
        burst(BURST_COUNT);
        timer = setInterval(createDrop, START_RATE_MS);

        // show CTA after 5 seconds
        ctaTimeout = setTimeout(() => {
          toLixiBtn.classList.add("show");
        }, 5000);
      }

      // ====== LIXI SCREEN ======
      function buildLixiGrid() {
        lixiGrid.innerHTML = "";
        LIXI_IMAGES.forEach((src, idx) => {
          const btn = document.createElement("button");
          btn.className = "lixi-btn";
          btn.type = "button";
          btn.setAttribute("aria-label", "Ch·ªçn bao l√¨ x√¨ " + (idx + 1));

          const img = document.createElement("img");
          img.className = "lixi-img";
          img.src = src;
          img.alt = "L√¨ x√¨ " + (idx + 1);

          btn.appendChild(img);
          btn.addEventListener("click", () => pickLixi(idx));
          lixiGrid.appendChild(btn);
        });
      }

      function openLixiScreen() {
        toLixiBtn.classList.remove("show");
        lixiScreen.classList.add("show");
        lixiScreen.setAttribute("aria-hidden", "false");
        buildLixiGrid();
        picked = false;
        locked = false;
      }

      function pickLixi(idx) {
        if (locked || picked) return;
        locked = true;
        picked = true;

        // dim others for drama
        [...lixiGrid.children].forEach((el, i) => {
          if (i !== idx) el.classList.add("dim");
        });

        // show black countdown overlay above everything
        runCountdownThenReveal();
      }

      function runCountdownThenReveal() {
        // hide pick screen smoothly
        lixiScreen.classList.remove("show");
        lixiScreen.setAttribute("aria-hidden", "true");

        // optional: pause rain spawn for smoothness
        if (timer) {
          clearInterval(timer);
          timer = null;
        }
        if (ctaTimeout) {
          clearTimeout(ctaTimeout);
          ctaTimeout = null;
        }

        // show overlay
        countOverlay.classList.add("show");
        countOverlay.setAttribute("aria-hidden", "false");

        cdLine.textContent = "Chu·∫©n b·ªã m·ªü‚Ä¶";
        cdBoom.style.display = "none";
        cdNum.style.display = "block";

        let t = 3;
        cdNum.textContent = String(t);

        const tick = setInterval(() => {
          t--;
          if (t >= 1) {
            cdNum.textContent = String(t);
          } else {
            clearInterval(tick);
            // show "B√ôM" briefly
            cdNum.style.display = "none";
            cdBoom.style.display = "block";
            cdBoom.textContent = "B√ôM! ‚ú®";

            setTimeout(() => {
              countOverlay.classList.remove("show");
              countOverlay.setAttribute("aria-hidden", "true");
              showWishScreen();
            }, 520);
          }
        }, 850);
      }

      function showWishScreen() {
        // fill wish
        moneyText.textContent = "üéâ " + pick(MONEY_LIST);
        wishText.textContent = pick(NEWYEAR_WISHES);
        noteText.textContent = FIXED_NOTE;

        wishScreen.classList.add("show");
        wishScreen.setAttribute("aria-hidden", "false");
      }

      function goFinal() {
        wishScreen.classList.remove("show");
        wishScreen.setAttribute("aria-hidden", "true");

        finalScreen.classList.add("show");
        finalScreen.setAttribute("aria-hidden", "false");
        // ƒë·ª©ng y√™n ·ªü m√†n cu·ªëi, kh√¥ng c·∫ßn l√†m g√¨ n·ªØa
        startHeartRain();
      }

      // ====== EVENTS ======
      heartBtn.addEventListener("click", () => {
        if (started) return;
        started = true;
        stage.classList.add("fade-out");
        setTimeout(() => startRain(), 700);
      });

      toLixiBtn.addEventListener("click", () => {
        if (!started) return;
        openLixiScreen();
      });

      continueBtn.addEventListener("click", () => {
        if (locked === false) locked = true;
        goFinal();
      });

      // ====== Tiny starfield (lightweight) ======
      const canvas = document.getElementById("stars");
      const ctx = canvas.getContext("2d");
      let W, H, stars;

      function resize() {
        const dpr = Math.min(devicePixelRatio || 1, 2); // cap ƒë·ªÉ ƒë·ª° lag
        W = canvas.width = Math.floor(window.innerWidth * dpr);
        H = canvas.height = Math.floor(window.innerHeight * dpr);
        canvas.style.width = window.innerWidth + "px";
        canvas.style.height = window.innerHeight + "px";

        // nhi·ªÅu sao h∆°n + gi·ªõi h·∫°n ƒë·ªÉ kh√¥ng lag
        const count = Math.min(
          260,
          Math.floor((window.innerWidth * window.innerHeight) / 5500),
        );

        stars = Array.from({ length: count }, () => ({
          x: Math.random() * W,
          y: Math.random() * H,
          r: Math.random() * 3.2 + 0.8,
          a: Math.random() * 0.9 + 0.1,
          tw: Math.random() * 0.035 + 0.012,
          flash: Math.random() < 0.04, // m·ªôt s·ªë sao ‚Äúnh√°y‚Äù m·∫°nh
        }));
      }

      function drawStars() {
        ctx.clearRect(0, 0, W, H);

        for (const s of stars) {
          // twinkle ng·∫´u nhi√™n
          s.a += (Math.random() > 0.5 ? 1 : -1) * s.tw;
          s.a = Math.max(0.06, Math.min(0.98, s.a));

          // v√†i sao flash m·∫°nh (l·∫•p l√°nh r√µ)
          const a1 = s.flash ? Math.min(1, s.a * 1.25) : s.a;

          // sao ch√≠nh
          ctx.globalAlpha = a1;
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
          ctx.fillStyle = "#fff";
          ctx.fill();

          // halo m·ªù (l·∫•p l√°nh)
          ctx.globalAlpha = a1 * 0.22;
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r * 4.0, 0, Math.PI * 2);
          ctx.fill();
        }

        ctx.globalAlpha = 1;
        requestAnimationFrame(drawStars);
      }
      window.addEventListener("resize", resize);
      resize();
      drawStars();
      // ====== Heart rain layer ======
      const heartRain = document.getElementById("heartRain");
      let heartTimer = null;

      function createHeart() {
        if (!heartRain) return;

        // gi·ªõi h·∫°n ƒë·ªÉ kh√¥ng lag
        if (heartRain.childElementCount > 120) {
          for (let i = 0; i < 10 && heartRain.firstChild; i++) {
            heartRain.removeChild(heartRain.firstChild);
          }
        }

        const el = document.createElement("div");
        el.className = "heart-drop";

        // tr√°i tim svg nh·ªè
        el.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M12 21s-7.2-4.4-9.6-8.7C.6 9.3 2.2 5.8 5.7 5.1c1.8-.4 3.6.3 4.7 1.6 1.1-1.3 2.9-2 4.7-1.6 3.5.7 5.1 4.2 3.3 7.2C19.2 16.6 12 21 12 21z"
        fill="rgba(255,77,166,0.85)"/>
    </svg>
  `;

        const x = rand(0, window.innerWidth); // px
        const dur = rand(5.0, 9.0);
        const rot = rand(-12, 12);
        const isPhone = window.matchMedia("(max-width: 520px)").matches;
        const sz = isPhone ? rand(10, 18) : rand(12, 26);

        el.style.setProperty("--dur", dur + "s");
        el.style.setProperty("--rot", rot + "deg");
        el.style.setProperty("--sz", sz + "px");

        heartRain.appendChild(el);

        // cƒÉn gi·ªØa theo width th·∫≠t
        const w = el.offsetWidth || sz;
        el.style.setProperty("--x", x - w / 2 + "px");

        el.addEventListener("animationend", () => el.remove());
      }

      function startHeartRain() {
        heartRain.classList.add("show");
        // burst
        for (let i = 0; i < 18; i++) setTimeout(createHeart, i * 40);
        heartTimer = setInterval(createHeart, 160);
      }

      function stopHeartRain() {
        heartRain.classList.remove("show");
        if (heartTimer) {
          clearInterval(heartTimer);
          heartTimer = null;
        }
        // d·ªçn b·ªõt cho nh·∫π
        heartRain.innerHTML = "";
      }
    </script>
  </body>
</html>
